# constraint-llm-agent

[参考1](https://aclanthology.org/2024.lrec-main.444.pdf)  
[参考2](https://aclanthology.org/2024.findings-emnlp.374.pdf)  
[参考3](https://aclanthology.org/2023.ijcnlp-srw.10.pdf)  
[参考4](https://www.anlp.jp/proceedings/annual_meeting/2025/pdf_dir/Q7-11.pdf)  
[参考5](https://github.com/facebookresearch/MUSE)  

---

source .venv/bin/activate

---

## 1. 研究目的とタスク定義

1. **研究仮説の明確化**

   * 「LLM（あるいはエージェント）に強い制約を与えるほど、誤った行動が減り、ゴール達成率が向上する」
2. **タスク設定**

   * 例：特定の構造（橋や塔など）をMinecraft上で組み立てる
   * 例：資源（木材・石など）を決められた量だけ集める

---

## 2. 制約デザイン

1. **禁止制約（Hard Constraint）**

   * “Lava に入ってはいけない”
   * “ホルダにないブロックは置けない”
2. **ペナルティ制約（Soft Constraint）**

   * “水辺ではMOVEコマンドのコストを +α”
3. **制約テンプレート化**

   * XML／YAML 形式で “type: PLACE, forbid: \[lava, cactus]” など記述

---

## 3. プロンプト＆モデル設定

1. **プロンプト構築**

   ```text
   あなたはMinecraftのエージェントです。以下の制約を必ず守ってください：…
   ゴール：石の塔を高さ5で作成せよ。
   行動可能：MOVE, JUMP, PLACE <block>, DIG <block>
   ```
2. **モデル選定・微調整**

   * GPT-4 系 LLM、あるいは RL エージェント（PPO 等）
   * プロンプト内に「Never do X」など強いキーワードを挿入

---

## 4. 事前チェック＆静的検証

1. **プラン検証**

   * 生成された action シーケンスを XML パーサで読み込み
   * “PLACE lava” が含まれる場合はプラン拒否
2. **ツール利用**

   * 自作スクリプトで AST 解析し、禁止アクションを検出

---

## 5. シミュレーション実行

1. **環境準備**

   * Malmo or Mineflayer + Java Minecraft サーバを Docker/WSL 上に起動
   * ワールド初期状態・スポーンポイントを固定
2. **アクション適用**

   * Bot に対し、`bot.pathfinder.goto()` や `bot.placeBlock()` で実行
   * 各ステップ完了後、worldstate を JSON ログ保存

---

## 6. リアルタイムモニタリング

1. **制約モニタリング**

   * 各ステップ毎に “制約違反フラグ” をログに保存
2. **性能計測**

   * ゴール達成ステップ数、総ステップ数、失敗回数
   * CPU／メモリ負荷（Tick lag）も同時取得

---

## 7. 結果集計＆可視化

1. **定量評価指標**

   * 成功率（違反なしでゴール到達した割合）
   * 平均ステップ数
   * 違反あたりのペナルティコスト
2. **グラフ作成**

   * 制約強度（ペナルティ重み） vs 成功率折れ線グラフ
   * ヒートマップ：各ブロック配置頻度

---

## 8. 反復改善

1. **制約調整**

   * Hard⇔Soft の切り替え、重みの最適化
2. **プロンプト改良**

   * 「絶対に〜する」→「〜しなければならない」など言い回しの強化
3. **モデル再学習／微調整**

   * 失敗ケースを追加学習データにして強化学習

---

## 9. （オプション）ヒューマン比較実験

1. **ユーザスタディ設計**

   * 人間プレイヤーと制約付きエージェントのパフォーマンス比較
2. **定性フィードバック**

   * プレイヤー・開発者インタビュー
   * 「制約が直感的か」「補助ツールとしての有用性」

---

### まとめ

このワークフローを通して、

* 制約の強度が行動品質に与える影響、
* 制約設計とプロンプト／モデル調整の繰り返し効果、
* 実際のMinecraftプレイにおける制約付きエージェントの実用性

